{% extends "_design.html" %}
{% block title %}Alert #{{ alert.id }} - Sentinel Commander{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold">🚨 Alert #{{ alert.id }}</h3>
        <a href="/web/v1/alerts" class="btn btn-outline-secondary">&larr; Back</a>
      </div>

      <!-- Basic Alert Information -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">{{ alert.message }}</h5>
          <p class="mb-1"><strong>Status:</strong> <span class="badge bg-secondary">{{ alert.status }}</span></p>
          <p class="mb-1"><strong>Severity:</strong> <span class="badge bg-danger">{{ alert.severity }}</span></p>
          <p class="mb-1"><strong>Source:</strong> {{ alert.source }}</p>
          <p class="mb-1"><strong>Source Event Time:</strong> {{ alert.source_event_time }}</p>
          <p class="mb-1"><strong>Created At:</strong> {{ alert.created_at }}</p>
          {% if alert.tags %}
            <p><strong>Tags:</strong>
              {% for tag in alert.tags.split(',') %}
              <span class="badge bg-info text-dark">{{ tag.strip() }}</span>
              {% endfor %}
            </p>
          {% endif %}
        </div>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs" id="alertTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-raw" type="button">🧾 Raw Payload</button>
        </li>
        {% if alert.parsed_fields %}
        <li class="nav-item">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-parsed" type="button">🔍 Parsed Fields</button>
        </li>
        {% endif %}
        {% if alert.observables %}
        <li class="nav-item">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-observables" type="button">📌 Observables</button>
        </li>
        {% endif %}
        {% if alert.enrichment %}
        <li class="nav-item">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-enrichment" type="button">🔧 Enrichment</button>
        </li>
        {% endif %}
      </ul>

      <div class="tab-content p-3 border border-top-0 rounded-bottom bg-light">
        <div class="tab-pane fade show active" id="tab-raw">
          <pre class="bg-dark text-white p-3 rounded" style="max-height: 600px; overflow: auto;">
            <code>{{ source_payload_json | tojson(indent=2) }}</code>
          </pre>
        </div>
        {% if alert.parsed_fields %}
        <div class="tab-pane fade" id="tab-parsed">
          <pre class="bg-dark text-white p-3 rounded"><code>{{ alert.parsed_fields }}</code></pre>
        </div>
        {% endif %}
        {% if alert.observables %}
        <div class="tab-pane fade" id="tab-observables">
          <pre class="bg-dark text-white p-3 rounded"><code>{{ alert.observables }}</code></pre>
        </div>
        {% endif %}
        {% if alert.enrichment %}
        <div class="tab-pane fade" id="tab-enrichment">
          <pre class="bg-dark text-white p-3 rounded"><code>{{ alert.enrichment }}</code></pre>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Sidebar Actions -->
    <div class="col-lg-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header fw-bold">Actions</div>
        <div class="card-body d-grid gap-2">
          <button class="btn btn-outline-info">⚙️ Run Playbooks</button>
          <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#editAlertModal">✏️ Edit Alert</button>
          <button class="btn btn-outline-primary">✫️ Promote to Case</button>
        </div>
      </div>

      {% if alert.resolution_comment %}
      <div class="card">
        <div class="card-header fw-semibold">📝 Analyst Comment</div>
        <div class="card-body">
          <p>{{ alert.resolution_comment }}</p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
