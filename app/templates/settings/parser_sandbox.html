{% extends "_design.html" %}
{% block title %}Parser Sandbox{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2>Parser Sandbox</h2>
  <form id="sandboxForm" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="parserFile" class="form-label">Upload YAML Parser</label>
      <input class="form-control" type="file" id="parserFile" name="parser_file" accept=".yml,.yaml" required>
    </div>
    <div class="mb-3">
      <label for="alertJson" class="form-label">Paste Alert JSON</label>
      <textarea class="form-control" id="alertJson" name="alert_json" rows="10" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Run Parser</button>
  </form>

  <hr>

  <div id="results" class="mt-4 d-none">
    <h4>Parsed Output</h4>
    <pre id="parsedOutput" class="bg-light p-3 border rounded"></pre>
  </div>

  <div id="errorBox" class="alert alert-danger d-none mt-4"></div>
</div>

<script>
document.getElementById("sandboxForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);

  const response = await fetch("/api/v1/parsers/sandbox", {
    method: "POST",
    body: formData
  });

  const result = await response.json();

  const outputDiv = document.getElementById("parsedOutput");
  const results = document.getElementById("results");
  const errorBox = document.getElementById("errorBox");

  if (result.success) {
    results.classList.remove("d-none");
    errorBox.classList.add("d-none");
    outputDiv.textContent = JSON.stringify(result.parsed, null, 2);
  } else {
    results.classList.add("d-none");
    errorBox.classList.remove("d-none");
    errorBox.textContent = result.error;
  }
});
</script>
{% endblock %}
